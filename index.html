<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" href="onsenui/css/onsenui.css">
    <link rel="stylesheet" href="onsenui/css/onsen-css-components.min.css">
    <script src="onsenui/js/onsenui.min.js"></script>
    <script src="./ncmb/ncmb.min.js"></script>
    <script src="./db.js"></script>
    <script src="angular.min.js"></script>
    <script src="onsenui/js/angular-onsenui.min.js"></script>

    <style>
        .arrow {
            position: relative;
            display: inline-block;
            padding-left: 20px;
            margin-top: 50px;
        }
        
        .arrow::before {
            content: '';
            width: 30px;
            height: 30px;
            border: 10px;
            border-top: solid 2px #5bc0de;
            border-right: solid 2px #5bc0de;
            transform: rotate(45deg);
            position: absolute;
            left: 0;
            margin-top: -4px;
        }
        
        .arrowL {
            position: relative;
            display: inline-block;
            padding-left: 20px;
            margin-top: 50px;
        }
        
        .arrowL::before {
            content: '';
            width: 30px;
            height: 30px;
            border: 10px;
            border-top: solid 2px #5bc0de;
            border-right: solid 2px #5bc0de;
            transform: rotate(-135deg);
            position: absolute;
            left: 10;
            margin-top: -4px;
        }
        
        .form-style-6 {
            font: 95% Arial, Helvetica, sans-serif;
            max-width: 400px;
            margin: 10px auto;
            padding: 16px;
            background: #F7F7F7;
        }
        
        .form-style-6 h1 {
            background: #43D1AF;
            padding: 20px 0;
            font-size: 140%;
            font-weight: 300;
            text-align: center;
            color: #fff;
            margin: -16px -16px 16px -16px;
        }
        
        .form-style-6 input[type="text"],
        .form-style-6 input[type="date"],
        .form-style-6 input[type="datetime"],
        .form-style-6 input[type="email"],
        .form-style-6 input[type="number"],
        .form-style-6 input[type="search"],
        .form-style-6 input[type="time"],
        .form-style-6 input[type="url"],
        .form-style-6 textarea,
        .form-style-6 select {
            -webkit-transition: all 0.30s ease-in-out;
            -moz-transition: all 0.30s ease-in-out;
            -ms-transition: all 0.30s ease-in-out;
            -o-transition: all 0.30s ease-in-out;
            outline: none;
            box-sizing: border-box;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            width: 100%;
            background: #fff;
            margin-bottom: 4%;
            border: 1px solid #ccc;
            padding: 3%;
            color: #555;
            font: 95% Arial, Helvetica, sans-serif;
        }
        
        .form-style-6 input[type="text"]:focus,
        .form-style-6 input[type="date"]:focus,
        .form-style-6 input[type="datetime"]:focus,
        .form-style-6 input[type="email"]:focus,
        .form-style-6 input[type="number"]:focus,
        .form-style-6 input[type="search"]:focus,
        .form-style-6 input[type="time"]:focus,
        .form-style-6 input[type="url"]:focus,
        .form-style-6 textarea:focus,
        .form-style-6 select:focus {
            box-shadow: 0 0 5px #43D1AF;
            padding: 3%;
            border: 1px solid #43D1AF;
        }
        
        .form-style-6 input[type="submit"],
        .form-style-6 input[type="button"] {
            box-sizing: border-box;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            width: 100%;
            padding: 3%;
            background: #43D1AF;
            border-bottom: 2px solid #30C29E;
            border-top-style: none;
            border-right-style: none;
            border-left-style: none;
            color: #fff;
        }
        
        .form-style-6 input[type="submit"]:hover,
        .form-style-6 input[type="button"]:hover {
            background: #2EBC99;
        }
    </style>
</head>

<body ng-app="apps" class="container">

    <ons-page>
        <div ng-controller="GameController">
            {{answer}}
            <div class="toolbar">
                <div class="toolbar__center">PTGAME(【真ん中当てクイズ】)</div>
            </div>
            </ons-row>
            <ons-row>
                <ons-col width="100%">
                    <div style="width:100%;height: 200px; padding: 1px 0 0 0;">
                        <ons-row>
                            <ons-col width="10%">
                                <div class="arrowL" ng-click="back()"></div>
                            </ons-col>

                            <ons-col width="80%">
                                <div class="card">
                                    <h2 class="card__title">第{{currentNum+1}}問</h2>
                                    <div class="card__content">
                                        {{gameData[currentNum].title}}
                                    </div>
                                </div>
                            </ons-col>


                            <ons-col width="10%">
                                <div class="arrow" ng-click="forward()"></div>
                            </ons-col>
                        </ons-row>
                    </div>

                </ons-col>
            </ons-row>

            <ons-row>


                <div class="form-style-6" ng-show="currentNum == 0">
                    <form>
                        <ons-row>
                            <ons-col>
                                <input type="text" name="field1" ng-model="answer" placeholder="何時" />
                                <input type="text" name="field1" ng-model="answer2" placeholder="何分" / </ons-col>
                        </ons-row>
                    </form>
                </div>

                <div class="form-style-6" ng-show="currentNum == 1">
                    <form>
                        <input type="text" name="field1" ng-model="answer" placeholder="何時間" />
                        <input type="text" name="field1" ng-model="answer2" placeholder="何分" />
                    </form>
                </div>

                <div class="form-style-6" ng-show="currentNum == 2">
                    <form>
                        <input type="text" name="field1" ng-model="answer" placeholder="日本円ですよ" />
                    </form>
                </div>

                <div class="form-style-6" ng-show="currentNum == 3">
                    <form>
                        <input type="text" name="field1" ng-model="answer" placeholder="日本円ですよ" />
                    </form>
                </div>

                <div class="form-style-6" ng-show="currentNum == 4">
                    <form>
                        <input type="text" name="field1" ng-model="answer" placeholder="ドールですよ" />
                    </form>
                </div>

                <div class="form-style-6" ng-show="currentNum == 5">
                    <form>
                        secret
                    </form>
                </div>

            </ons-row>
            <ons-row>
                <button class="button--large--cta" style="width: 100%; margin: 0 auto;" ng-disabled="buttonDisable" ng-click="submit()">サブミット</button>
            </ons-row>
        </div>
    </ons-page>


</body>

<script>
    var APPLICATION_KEY = "e49d2a7325b1de31930285ecfceb148c6c07bd1b0ff87cc9ccb3e6836aeb7151";
    var CLIENT_KEY = "4c5ff454f2fbf0bb0ed2b4088fa54f37602aba3744e6d6bc079a3886c44aa4e3";
    var ncmb = new NCMB(APPLICATION_KEY, CLIENT_KEY);

    var module = angular.module('apps', []);

    module
        .controller('GameController', function($scope) {
            $scope.buttonDisable = false;
            login();
            $scope.currentNum = 0;
            $scope.currentUser = {}
            $scope.gameData = [{
                num: 0,
                title: "　「休日朝起きる時間」→チュートリアル"
            }, {
                num: 1,
                title: "「通勤時間」"
            }, {
                num: 2,
                title: "「理想の年収」"
            }, {
                num: 3,
                title: "「自分の今年一番の買い物の値段」"
            }, {
                num: 4,
                title: "「香川さんの一番の買い物の値段は？」"
            }]

            $scope.forward = function() {
                $scope.buttonDisable = false;
                $scope.answer = null;
                if ($scope.currentNum == $scope.gameData.length - 1) {
                    return;
                }
                $scope.currentNum++;
            }

            $scope.back = function() {
                $scope.buttonDisable = false;
                $scope.answer = null;
                if ($scope.currentNum == 0) return;
                $scope.currentNum--;
            }

            $scope.submit = function() {
                $scope.buttonDisable = true;
                console.log($scope.currentUser)

                if (isEmpty($scope.currentUser)) {
                    alert("ログインされていない")
                } else {

                    getCurrentUser();

                    myDB.findAllData("response", {
                        questionNum: $scope.currentNum,
                        username: $scope.currentUser.userName
                    }, function(err, res) {
                        if (err) {
                            console.log("err")
                            alert("err in try to find the duplicated answer exists or not")
                            return;
                        }

                        if (res.length > 0) {
                            alert("you have already submited for this answer")
                            return;
                        }


                        dealWithAndSubmitAnswer();

                    })

                }
            }

            function login() {
                myDB.login("joshoi", "joshoi", function(err, res) {
                    console.log(res)
                    $scope.currentUser = res;
                })
            }

            function getCurrentUser() {
                var currentUser = myDB.getCurrentUser()
                console.log(currentUser)
                $scope.currentUser = currentUser;
            }

            function isEmpty(obj) {
                for (var prop in obj) {
                    if (obj.hasOwnProperty(prop))
                        return false;
                }
                return true;
            }

            function dealWithAndSubmitAnswer() {
                var obj = {}
                if ($scope.currentNum == 0) {
                    obj = {
                        answer: $scope.answer,
                        answer2: $scope.answer2
                    }
                } else if ($scope.currentNum == 1) {
                    obj = {
                        answer: $scope.answer,
                        answer2: $scope.answer2
                    }
                } else if ($scope.currentNum == 2) {
                    obj = {
                        answer: $scope.answer
                    }
                } else if ($scope.currentNum == 3) {
                    obj = {
                        answer: $scope.answer
                    }
                } else if ($scope.currentNum == 4) {
                    obj = {
                        answer: $scope.answer
                    }
                } else if ($scope.currentNum == 5) {

                } else {

                }



                obj.username = $scope.currentUser.userName,
                    obj.questionNum = $scope.currentNum,


                    myDB.insertIntoDataBase("response", obj, function(err, res) {
                        if (err) console.log(err)
                        alert("答えました")
                        $scope.buttonDisable = false;
                    })


            }




        });
</script>

</h